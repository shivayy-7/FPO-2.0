<%@ page language="java" contentType="text/html; charset=ISO-8859-1" pageEncoding="ISO-8859-1"%>
<%@ page isELIgnored="false"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="tiles" uri="http://tiles.apache.org/tags-tiles"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script src="${contextPath}/assets/appJs/validation/common-utils.js"></script>
<script src="${contextPath}/assets/appJs/ajaxJs/commonAjax.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">


<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<c:set var="tlength" value="${fn:length(managementDetails)}" />

<style>
.mandotory::before {
  content: '* '; /* Display an asterisk followed by a space before the header text */
  color: red;    /* Optionally, set the color to red or any other desired color */
}
</style>
<div class="content">
   <div class="panel-header bg-primary-gradient">
      <div class="page-inner py-4">
         <div
            class="d-flex align-items-left align-items-md-center flex-column flex-md-row">
            <div>
               <h2 class="text-blue pb-2 fw-bold">FPO Training Management</h2>
            </div>
<%--             <jsp:include page="/WEB-INF/views/message.jsp" /> --%>
            <div class="ml-md-auto mb-4 py-2 py-md-0">
               <a href="${contextPath}" class="btn btn-sm btn-border btn-blue btn-round mr-2"><i class="fa fa-home"></i></a> 
               <a href="${contextPath}" class="btn btn-sm btn-border btn-blue btn-round mr-2">/FPO Training Management</a>
            </div>
         </div>
      </div>
   </div>
   <div class="page-inner mt--5 pb-0">
   <%@ include file="/WEB-INF/views/message.jsp"%>
   <%@ include file="/WEB-INF/views/ajaxLoader.jsp"%>
      <div class="row mt-3">
         <div class="col-md-12">
            <div class="card full-height">
               <div class="card-header">
                  <div class="panel-actions">
                     <a href="#" class="fa fa-caret-down"></a>
                  </div>
                  <h4 class="card-title">FPO Training Management:</h4>
               </div>
               <div class="card-body" style="">
                  <div class="col-md-12">
                     <form action="${contextPath}/training/manageTraining" id="submitForm" method="POST" > 
						<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
						<input type="hidden" name="trainingVO.trainingId" id="pcProfileId" value="${trainingDtls.trainingVO.trainingId}"/>
						<input type="hidden" name="trainingVO.trainingCode" value="${trainingDtls.trainingVO.trainingCode}"/>
						<input type="hidden" name="trainingVO.status" id="statusCode" />
                        <div class="col-md-12">
                           <h4 class="card-title">Basic Details:</h4>
                        </div>
                        <div class="col-md-12">
                           
                          <div class="col-md-3">
                              <div class="form-group">
                                 <label class="col-md-12 smallInput required" for="schemeName">Subject :</label>
                                 <div class="col-md-12">
                                    <select class="form-control form-control-sm" id="schemeId" name="trainingVO.subject">
                                       <option value="0">--Select--</option>
											<c:forEach items="${SubjectList}" var="subject">   
                                               <option value="${subject.subjectName}" ${subject.subjectName eq trainingDtls.trainingVO.subject ?'selected':'' }> ${subject.subjectName}</option>
                                           </c:forEach>
                                    </select>
                                 </div>
                              </div>
                           </div>
                           
                           <div class="col-md-3">
                              <div class="form-group">
                                 <label class="col-md-12 smallInput required" for="schemeName">Trainer :</label>
                                 <div class="col-md-12">
                                    <select class="form-control form-control-sm" id="schemeId" name="trainingVO.trainer.id">
									    <option value="0">--- Select ---</option>
									    <c:forEach items="${cbboMngmntList}" var="cbboMngmnt">   
									          <option value="${cbboMngmnt.id}" ${cbboMngmnt.id eq trainingDtls.trainingVO.trainer.id ? 'selected':''}>${cbboMngmnt.cbboMngmtName}</option>
									    </c:forEach>
									</select>
									
                                 </div>
                              </div>
                           </div>
                           
                            <div class="col-md-3">
                               <div class="form-group">
                                   <label for="" class="col-md-12 smallInput required">Training To Whom(FPO) :</label>
                                   <div class="col-md-12">
                                       <%-- <select class="form-control form-control-sm" name="trainingVO.fpoId" id="fpoId" multiple="multiple">
                                           <option value="0">--- Select ---</option>
                                           <c:forEach items="${FpoList}" var="fpo">   
                                               <option value="${fpo.fpoId}" ${fpo.fpoId eq trainingDtls.trainingVO.fpoId ? 'selected' : '' }> ${fpo.fpoName}</option>
                                           </c:forEach>
                                       </select> --%>
                                       <select class="form-control form-control-sm" name="trainingVO.fpoId" id="fpoId" multiple="multiple">
									    <option value="0">--- Select ---</option>
									    <c:forEach items="${FpoList}" var="fpo">
									        <c:set var="isSelected" value="false" />
									        <c:forEach items="${trainingDtls.trainingVO.fpoId}" var="selectedFpoId">
									            <c:if test="${selectedFpoId == fpo.fpoId}">
									                <c:set var="isSelected" value="true" />
									            </c:if>
									        </c:forEach>
									        <option value="${fpo.fpoId}" ${isSelected ? 'selected' : ''}>${fpo.fpoName}</option>
									    </c:forEach>
									</select>
                                       
                                   </div>
                               </div>
                           </div> 
                           
                           <div class="col-md-3">
                              <div class="form-group">
                                 <label class="col-md-12 smallInput " for="fpoName">Date:</label>
                                 <div class="col-md-12">
                                    <input type="date" name="trainingVO.dateOfEvent" maxlength="6"  id="dateOfEvent" class="form-control form-control-sm datepicker_con1" value="${trainingDtls.trainingVO.dateOfEvent}">
                                 </div>
                              </div>
                           </div> 
                           
                           </div>
                            
                            
                            <div class="col-md-12">
                              <div class="col-md-3">
                              <div class="form-group">
                                 <label class="col-md-12 smallInput required" for="fpoName">Event Desciption:</label>
                                 <div class="col-md-12">
                                    <textarea id="w3review" name="trainingVO.eventDesc" rows="4" cols="50">${trainingDtls.trainingVO.eventDesc}</textarea>
                                 </div>
                              </div>
                           </div>  
                           </div> 
                           
                        
                        <div class="col-md-12 text-center mt-3">
								<input type="button" class="btn btn-primary btn-sm" onclick="submitButton('UPCOMING');" value="Save As Draft"/>
								<input type="button" class="btn btn-success btn-sm" onclick="submitButton('UPCOMING');" value="Submit"/>
									<a href="${contextPath}/home" class="btn btn-danger btn-sm">Back</a>
						</div>
                     </form>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
  <div>
<c:if test="${not empty trainingDtls.trainingVO.trainingId}">
 <div class="card-body" style="">
                        <div class="col-md-12" id="tabs">
		<div align="center">
        <table border="1" cellpadding="5">
            <tr>
                <th>#Sl.No</th>
                <th>Fpo Name</th>
                <th>Action</th>
            </tr>
            <c:forEach var="training" items="${trainingDtls.trainingFpoMapVo}" varStatus="loop">
                <tr>
                    <td>${loop.index + 1}</td>
                    <td>${training.fpoId.fpoName}</td>
                    <td>
                      <c:if test="${training.trainingAcceptance eq true}">
                        <a><i class="far fa-check-circle" style="color: green;"></i></a>
                      </c:if>
                      <c:if test="${training.trainingAcceptance eq false}">
                        <a><i class="far fa-times-circle" style="color: red;"></i></a>
                      </c:if>
                    </td>
                </tr>
            </c:forEach>
        </table>
    </div>
  </div>
  </div>
</c:if>
  </div>
</div>	


 <div>
<c:if test="${not empty sceduledTrainingList.trainingList}">
 <div class="card-body" style="">
 <h4 class="card-title">FPO Training List :</h4>
                        <div class="col-md-12" id="tabs">
		<ul class="nav nav-tabs mb-3 ">
				<li class="nav-item"><a class="nav-link" data-toggle="tab"
					href="#draft" id="a" onclick="trainingFpo('UPCOMING')">Upcoming</a></li>
			<li class="nav-item "><a
				class="nav-link "
				data-toggle="tab" href="#pending" id="b" onclick="trainingFpo('COMPLETE')">Complete</a></li>
		</ul>
				<div class="col-md-12">

					<div align="center" id="upcoming">
						<table border="1" cellpadding="5">
							<tr>
								<th>#Sl.No</th>
								<th>Subject</th>
								<th>Trainer</th>
								<th>Date</th>
								<th>Action</th>
							</tr>
							<c:forEach var="training" items="${sceduledTrainingList.trainingList}" varStatus="loop">
								<tr>
									<td>${loop.index + 1}</td>
									<td>${training.subject}</td>
									<td>${training.trainer.cbboMngmtName}</td>
									<td>${training.dateOfEvent}</td>
									<td><a
										href="${contextPath}/training?searchCode=${training.trainingCode}"><i
											class="fa fa-eye" aria-hidden="true"></i></a> <a></a></td>
								</tr>
							</c:forEach>
						</table>
					</div>
					
				</div>
			</div>
  </div>
</c:if>
  </div>

	
  </div> 
   	 <form action="${contextPath}/training" id="formSubmit">
   	     <input type="hidden" name="tabCode" id="tabCode" value="${tabCode}">
   	     <input type="hidden" name="searchCode" id="searchCode" value="${tabCode}">
   	 </form>
<script>

function trainingFpo(status){
	debugger;
	
	if(status == 'UPCOMING'){
		$("#tabCode").val(status);
		$("#formSubmit").submit();
	}else if(status == 'COMPLETE'){
		$("#tabCode").val(status);
		$("#formSubmit").submit();
	}
}

    $(document).ready(function() {
    	debugger;
        if('${tabCode}'=='UPCOMING'){
            $("#draft").addClass("in active");
            $("#a").addClass("active");
        }else if('${tabCode}'=='COMPLETE'){
            $("#pending").addClass("active show");
            $("#b").addClass("active");
        }

    });

</script>   	 
   	 
<script>
 
function savePGArtisanProfile(){
	$("#submitForm").submit();
}


 
 function submitButton(status){
	 debugger;
	 $("#statusCode").val(status);
	 $("#submitForm").submit();
 }
 
 
 $('.amount').keyup(function(){
	    var val = $(this).val();
	    if(isNaN(val)){
	         val = val.replace(/[^0-9\.]/g,'');
	         if(val.split('.').length>2) 
	             val =val.replace(/\.+$/,"");
	    }
	    $(this).val(val); 
	});
 
 function mailVal(){
		debugger;
		var email = $("#emailId").val();
		var pattern =/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
		if(!pattern.test(email)){
			bootbox.alert("Not valid email address");
			$("#emailId").val('');
			return false;
		}
	}
 
 
	
	
	
	 
	function duplicateCodeCheck(code){
		$.ajax({
			type : "GET",
			url : "${contextPath}/fpo/duplicate_cin_no",
			data : {
				"nameField" : code,
			}, 
			success : function(response) {
				var val = JSON.parse(response); 
				hideAjaxLoader();
				if (val.isDuplicate == true) {
					if($("#cin_no").val() != val.cinno){
					bootbox.alert("Duplicate CIN NO entered.");
					$("#cinno").val("");
					}
				} 
			}, 
			error : function(error) {
				bootbox.alert('Something went wrong');
			}
		});
}

	function deleteInfraDetails(id){
		debugger;
		$("#hdnmanagmentDtlId").val(id);
		bootbox.confirm({
		    message: "Do you want to Deleted this row?",
		    buttons: {
		        confirm: {
		            label: 'Yes',
		            className: 'btn-success'
		        },
		        cancel: {
		            label: 'No',
		            className: 'btn-danger'
		        }
		    },
		    callback: function (result) {
		    	if (result == true) {
		    		$("#removeInfraForm").submit();
 				}
		    }
		});
		
	}
	
	$('.NumbersOnly').on(
			'keypress',
			function(event) {
				var regex = new RegExp("^[0-9.]+$");
				var key = String.fromCharCode(!event.charCode ? event.which
						: event.charCode);
				if (!regex.test(key)) {
					event.preventDefault();
					return false;
				}
			});
	
	
	
	function isMobileValid(count, valueNm){
		var rows = $('#managementRow tr').length;
		 for (i = 1; i <= rows; i++) {
			var count1=i
			var valueName = $('#phonenumber'+count1).val();
			var filter = /^\d*(?:\.\d{1,2})?$/;
			if (filter.test(valueName) && valueName.length != 10) {
				bootbox.alert("Invalid phone no.");
				$("#phonenumber"+count).val("");
				return false;
			}
			else{
				return true;
			}
		  } 
		
}
	
	function ValidAadhaarNoCheck(that){
var valueNm = $('#' + that.id).val();
var filter = /^\d*(?:\.\d{1,2})?$/;
  if (filter.test(valueNm)) {
    if(valueNm.length==12){
     } else {
    	 bootbox.alert('Invalid Aadhaar No');
   	  $("#"+that.id).val(''); 
        return false;
      }
    }
    else {
    	bootbox.alert('Invalid Aadhaar No');
  	  $("#"+that.id).val(''); 
      return false;
   }	
		if (!ValidAadhaarNo(valueNm)) {
	        bootbox.alert("Invalid Aadhaar No");
	        $("#"+that.id).val(''); 
	        return false;
	    }
		
}
	
	
	function  ValidAadhaarNoCheckCount(count, that){
		var rows = $('#managementRow tr').length;
		
		 for (i = 1; i <= rows; i++) {
				var count1=i
				var valueName = $('#aadharNo'+count1).val();
				
				var filter = /^\d*(?:\.\d{1,2})?$/;
				  if (filter.test(valueName)) {
				    if(valueName.length==12){
				     } else {
				    	 bootbox.alert('Invalid Aadhaar No');
				   	  $("#"+that.id).val(''); 
				        return false;
				      }
				    }
				    else {
				    	bootbox.alert('Invalid Aadhaar No');
				  	  $("#"+that.id).val(''); 
				      return false;
				   }	
				if (!ValidAadhaarNo(valueName)) {
			        bootbox.alert("Invalid Aadhaar No");
			        $("#aadharNo"+count).val("");
			        return false;
			    }
			  } 
	}
	
	$(function() {
		$('.datepicker_con1 > input').datepick({
	        onShow: $.datepick.monthOnly, dateFormat: 'dd/mm/yyyy',showOnFocus: true,
	        showTrigger: '<button type="button" class="trigger">' +
	            '<i class="fa fa-calendar"></i></button>',
	                maxDate : -0,
	               // minDate: 0,
	    		onSelect: function(d){
//	     			checkSlotforBanner(this.value);
//	     			checkBannerEvent(this.value);
	    	     }
	    });
	});
	
	
	
</script>